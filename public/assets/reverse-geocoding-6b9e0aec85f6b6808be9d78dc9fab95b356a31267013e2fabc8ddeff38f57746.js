function load_rgeo_code(){$(".resolved-address").each(function(){var e=$(this).find("a");0==e.length?$(this).attr("title",$.trim($(this).text())):e.parent().attr("title",$.trim(e.text()))});var e=[];$.each(readings,function(t,d){if(null===d.address&&d.lat&&d.lng)e.push(d.id);else if(frm_index){var s=getDeviceByLastGPSReadingId(d.id);s&&(s.address=s.address.replace("Getting Address...",d.address))}}),e.length>0&&(rgeo_queued_message="reading_ids="+e.join(","),send_if_ready())}function send_if_ready(){ready_to_send()?(null!=rgeo_queued_message&&($.get("/geocoded_locations",rgeo_queued_message,function(e){rgeo_received(e)},"json"),rgeo_queued_message=null),attempts_remaining>0&&attempts_remaining--,last_sent=(new Date).getTime()):(clearTimeout(send_timeout),send_timeout=setTimeout("send_if_ready()",1e3*Math.pow(2,backoff[empty_count])))}function ready_to_send(){return!(attempts_remaining<=0)&&(new Date).getTime()-last_sent>send_throttle}function showReadings(){$.each(updated_readings,function(e,t){$(".geocode_"+t.id).html(t.address)}),updated_readings=[]}var rgeo_queued_message=null,last_sent=0,send_timeout=0,send_throttle_fast=200,send_throttle_slow=500,send_throttle=send_throttle_fast,attempts_remaining=10,empty_count=0,max_empties=10,updated_readings=[],backoff=[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7],rgeo_received=function(e){e&&e.data&&e.data.length?($.each(e.data,function(e,t){switch(t.type){case"reading":var d=getReadingById(t.id);if(d&&(d.address=t.address,updated_readings.push(d)),frm_index){var s=getDeviceByLastGPSReadingId(t.id);s&&(s.address=s.address.replace("Getting Address...",t.address))}}}),send_throttle=send_throttle_fast,empty_count=0,showReadings(),attempts_remaining=120):(empty_count++,send_throttle=send_throttle_slow,empty_count>=max_empties&&(attempts_remaining=0)),load_rgeo_code()};