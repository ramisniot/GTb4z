function load(){$("#map").length>0&&(initializeGoogleMap(),google.maps.event.addDomListenerOnce(gmap,"idle",function(){var e=document.location.href.split("/")[3],a=document.location.href.split("/")[4];e.match(/home/)||"admin"==e?getRecentReadings(!0,"from_load"):"trip"==a?displayTripOverview():"reports"==e||"devices"==e?getReportBreadcrumbs():"geofence"!=e&&device_id!=undefined&&getBreadcrumbs(device_id)}))}function openInfoWindowHtml(e,a,n,i){window.currentInfoWindow!=undefined&&window.currentInfoWindow.close();var t=i||-50,o={position:e,content:a,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,t),zIndex:null,boxClass:"infobox",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1,closeBoxURL:"/assets/infowindow_close-e1c41755c30d9243aa69542dd1f950d72faaff1c4908a7b83a2081277be29cdd.svg",alignBottom:!i},s=new InfoBox(o);window.currentInfoWindow=s,google.maps.event.addDomListener(s,"closeclick",function(){dev_id=!1,highlightRow(0),window.activeDeviceId=null}),s.open(gmap)}function updateDeviceAddress(e){var a=getDeviceByLastGPSReadingId(e.id);a&&(a.address=a.address.replace("Getting Address...",e.address),updateDeviceRow({id:a.id,helper_standard_location:a.address,dt:a.dt}))}function getLastReadingInfo(){setTimeout("lastReadingInfoCall();",5e3)}function lastReadingInfoCall(){$.get("/readings/get_last_reading_info_for_devices.json").done(function(e){for(var a=0;a<e.length;a++){var n=JSON.parse(e[a]);if(void 0===getReadingById(n.id)&&readings.push(n),null!=n.address){var i=getReadingById(n.id);i&&(i.address=n.address,updated_readings.push(i)),frm_index&&updateDeviceAddress(n)}}load_rgeo_code(),showReadings()})}function getRecentReadings(e,a){$("#updating").show();var n,i=new google.maps.LatLngBounds,t=!1;if(window.dispatchResult!=undefined&&window.dispatchResult.length>0&&i.extend(new google.maps.LatLng(window.dispatchResult[0],window.dispatchResult[1])),"from_load"!=a)n="/readings/recent/"+a+".json",$.ajax({url:n}).done(function(e){window.dispatchResult!=undefined&&window.dispatchResult.length>0&&drawGeocodingResult(window.dispatchResult[0],window.dispatchResult[1]);for(var a=0;a<e.length;a++){var n=e[a];d=getDeviceById(n.id),d&&(d.lat=n.latitude,d.lng=n.longitude,d.speed=n.speed,d.dt=n.dt,d.full_dt=n.full_dt,d.address=n.helper_standard_location,d.last_gps_reading_id=n.last_gps_reading_id,d.direction=n.direction,d.geofence=n.geofence),n.status=e[a].latest_status_html,n.icon_id=e[a].icon_id,n.name=e[a].name,n.id=e[a].id,n.reading_id=e[a].last_location_id,n.lat=n.latitude,n.lng=n.longitude,populate_the_table(n,frm_index,i)}e.length>0&&null!=window.activeDeviceId&&focusOn(window.activeDeviceId),$("#updating").hide(),load_rgeo_code()});else{null!=devices[0]&&(t=!0);for(var o=0;o<devices.length;o++){var s=devices[o];populate_the_table(s,!1,i)}if(t&&(e==undefined||1==e))if(dev_id){var s=getDeviceById(dev_id);new_drag_point||new google.maps.LatLng(s.lat,s.lng);centerMap(dev_id)}else new_drag_point||(google.maps.event.addListenerOnce(gmap,"bounds_changed",function(){this.getZoom()>18&&this.setZoom(18)}),gmap.fitBounds(i));window.dispatchResult!=undefined&&window.dispatchResult.length>0&&drawGeocodingResult(window.dispatchResult[0],window.dispatchResult[1]),$("#updating").hide()}}function drawGeocodingResult(e,a){var n=new google.maps.Marker({position:new google.maps.LatLng(e,a),map:gmap,icon:"/assets/icons/destination-1ee94649d19517dc57c4f1d9620c7e7f803a048a0ddc293e3981bffad9a29db5.png",clickable:!0});google.maps.event.addDomListener(n,"click",function(){openInfoWindowHtml(new google.maps.LatLng(e,a),window.dispatchAddress+'<br /><br />Click <a href="/geofences/new?geofence[radius]=0.1&geofence[latitude]='+e+"&geofence[longitude]="+a+"&geofence[address]="+window.dispatchAddress+'">here</a> to save this Location.<br /><br /><a href="#" onclick="maxZoomTo('+e+","+a+')">Zoom In</a>')}),n.setMap(gmap)}function updateDeviceRow(e){var a=$("#row"+e.id)[0];if(a&&a.getElementsByTagName){var n=a.getElementsByTagName("td");n[1].innerHTML=e.helper_standard_location,e.status&&(n[2].innerHTML=e.status),n[3].innerHTML=e.dt}}function populate_the_table(e,a,n){a&&updateDeviceRow(e);var i=new google.maps.LatLng(e.lat,e.lng);window.markers==undefined&&(window.markers={}),window.markers[e.id]!=undefined&&(window.markers[e.id][0].setMap(null),window.markers[e.id][1].setMap(null));var t=createLabeledMarker(e.id,i,e.name,marker_image(e.icon_id),createDeviceHtml(e.id)),o=createMarker(e.id,i,e.name,createArrow(e.direction,e.speed),createDeviceHtml(e.id));window.markers[e.id]=[t,o],window.markers[e.id][0].setMap(gmap),window.markers[e.id][1].setMap(gmap),n.extend(i)}function marker_image(e){if(null==e)return"/assets/icons/ublip_marker-3c0878cf26221b53d0b44c7d6eaf90e43fd149fcc420026d09842171470a36d7.png";if(e.toString().length<3)switch(e.toString()){case"1":return"/assets/icons/ublip_marker-3c0878cf26221b53d0b44c7d6eaf90e43fd149fcc420026d09842171470a36d7.png";case"2":return"/assets/icons/ublip_red-a94a729480f250f66c3c0323a46f977f8a06da21c5976acd14863f2bcb21af03.png";case"3":return"/assets/icons/green_small-cc34d2c2c83a80756016d52bfc8c1f432a0f05a7a2a95b36e12bae2b6e5e3b59.png";case"4":return"/assets/icons/yellow_small-1ae8e785333694fb3c664547896138a5f40df8b2c12cd38ac083fe05e64b736b.png";case"5":return"/assets/icons/purple_small-b94cbca2b53e0b0e647cf180565fcadcc636e24c8f0021ca011bfa7b67c6e30f.png";case"6":return"/assets/icons/dark_blue_small-d4004b22f46037ad5e85564cac51be46638d6ec8bf6df381a44a7448e4ad58b6.png";case"7":return"/assets/icons/grey_small-3877c4e901a30f9549d88cf57a5792af8b99e5efd83ba01f5b0b1fcf9c39029d.png";case"8":return"/assets/icons/orange_small-86b81cdec0003be42699404532bc5fec45ef621e59b1da0708335f9a40f641c6.png";default:return"/assets/icons/ublip_marker-3c0878cf26221b53d0b44c7d6eaf90e43fd149fcc420026d09842171470a36d7.png"}return e}function centerMap(e){dev_id=e;var a=getDeviceById(e);if(new_drag_point)var n=new_drag_point;else if(a)var n=new google.maps.LatLng(a.lat,a.lng);gmap&&n&&gmap.setCenter(n),a&&openInfoWindowHtml(new google.maps.LatLng(a.lat,a.lng),createDeviceHtml(e))}function getDeviceById(e){for(var a=0;a<devices.length;a++){var n=devices[a];if(n.id==e)return n}return null}function createDeviceHtml(e){var a=getDeviceById(e);if(a){var n=moment(a.full_dt,"DD-MMM-YYYY hh:mm A"),i=n.format("DD MMM"),t=n.format("YYYY"),o=n.format("hh:mm"),s=n.format("a"),d='<div class="tt_container__sidebar"><div class="tt_container__sidebar__date_container"><span class="infobox__date">'+i+'</span><br /><span class="infobox__date">'+t+'</span><br /><span class="infobox__date--bold">'+o+'</span><span class="infobox__date--small">'+s+"</span><br /></div></div>",r='<p class="tt_container__body__name">'+a.name+'</p><span class="tt_container__body__text-small"> was last seen at </span><br /><span><div id="bubble_rgeo_'+a.last_gps_reading_id+'" class="tt_container__body__link">'+a.address+"</div></span>",l="";a.phone_number!=undefined&&""!=a.phone_number&&(l+='<br /><span><a href="tel:'+a.phone_number+'">Call '+a.phone_number+"</span><br />");return'<div class="tt_container">'+d+'<div class="tt_container__body">'+r+'<div class="tt_container__body__text">'+speedAndDirectionHtml(a)+geofenceHtml(a)+"</div>"+l+deviceActionsHtml(a)+'</div><div class="clearfix"></div></div>'}}function deviceActionsHtml(e){var a=e.id,n='<br /><a href="#" class="tt_container__body__link" onclick="maxZoomTo('+e.lat+", "+e.lng+');">Zoom in</a> | <a href="/reports/all/'+a+'" class="tt_container__body__link">View details</a> | ';return e.has_movement_alert_for_current_user!=undefined&&e.has_movement_alert_for_current_user?n+="EZ-Alert has been set":n+='<span id="ezalert_'+a+'"><a href="#" class="tt_container__body__link" title="Instant next movement alert" onclick="$(\'#ezalert_'+a+"').load('/utils/set_movement_alert/"+a+"?lat="+e.lat+"&lng="+e.lng+"');\">EZ-Alert</a><span style='visibility: hidden'> has been set</span></span>",n}function speedAndDirectionHtml(e){if(e.speed!=undefined&&e.direction!=undefined){compass_dir=degrees_to_compass(e.direction,e.speed).toUpperCase();var a=e.speed,n="",i="";if(a!=undefined&&(i=a+" mph"),a!=undefined&&a>0&&"none"!=compass_dir&&(n="Heading "+compass_dir),""!=i&&""!=n)return"<br />"+n+" at "+i;if(0==a)return"Speed: 0 <br />"}return"<br />"}function geofenceHtml(e){return e.geofence!=undefined&&""!=e.geofence?" while "+e.geofence:" "}function focusOn(e){window.activeDeviceId=e,window.currentInfoWindow!=undefined&&window.currentInfoWindow.close(),centerMap(e),highlightRow(e),document.location.href="#device_"+e+"_anchor",$("#device_list_container")&&$("#device_list_container").scrollTop&&$("#device_list_container").scrollTop>20&&($("#device_list_container").scrollTop=$("#device_list_container").scrollTop-20)}function focusOnAndFollow(e){new_drag_point=null,focusOn(e)}function highlightRow(e){if(e!=undefined){var a=document.getElementById("row"+e);a!=undefined&&(prevSelectedRow&&(prevSelectedRow.className=prevSelectedRowClass),e>0&&(prevSelectedRow=a,prevSelectedRowClass=a.className,a.className="selected-row"))}}function getMarkerType(e){return e.start?"/assets/icons/start_marker-3ae82cfe8a0fc1509c62abcdfb26679a4c96265fec9d8ab30409e6056d1a41b7.png":e.stop?"/assets/icons/stop_marker-fcffceb612f9ad972b07936ad3b4a0f7ad3f1444273b49a99cba0611558395d5.png":"/assets/icons/ublip_marker-3c0878cf26221b53d0b44c7d6eaf90e43fd149fcc420026d09842171470a36d7.png"}function createMarker(e,a,n,i,t){var o=new google.maps.Marker({position:a,clickable:!0,zIndex:2*e+1,icon:i,flat:!0,title:n});return o.id=e,google.maps.event.addDomListener(o,"click",function(){window.currentlyDrawingDistanceRuler||(openInfoWindowHtml(a,t),gmap.setCenter(a),o&&o.id&&focusOnAndFollow(o.id))}),null==window.deviceLookupHash&&(window.deviceLookupHash={}),window.deviceLookupHash[o.id]=o,o}function toggleMap(){var e=document.getElementById("left_panel"),a=document.getElementById("right_panel"),n=document.getElementById("toggler");fullScreenMap?($(e).removeClass("reports-content__left--hidden"),$(a).removeClass("reports-content__right--full"),n.src="/assets/collapse-4d0a2cc2eeacfd6091f8ab38a808a13ca527bab7bf497eb11c78a7ae5f806aa3.png",n.parentNode.title="Expand map view",fullScreenMap=!1):($(e).addClass("reports-content__left--hidden"),$(a).addClass("reports-content__right--full"),n.src="/assets/expand-187bd31aa78c78f14cc0752a32796827e71352230802fd9cbd31c2dc24e2ef67.png",n.parentNode.title="Collapse map view",fullScreenMap=!0),google.maps.event.trigger(gmap,"resize")}function select_action(){document.location.href="/home/show_devices?group_type="+$("#group_type").val()}function degrees_to_compass(e,a){return 0===a||null===a||null===e?"none":e>=337.5||e<22.5?"n":e>=22.5&&e<67.5?"ne":e>=67.5&&e<112.5?"e":e>=112.5&&e<157.5?"se":e>=157.5&&e<202.5?"s":e>=202.5&&e<247.5?"sw":e>=247.5&&e<292.5?"w":e>=292.5&&e<337.5?"nw":void 0}function createLabeledMarker(e,a,n,i,t){var o={url:i,scaledSize:new google.maps.Size(28,39)},s=new LabeledMarker(gmap,a,{id:e,point:a,label:n,icon:o,html:t,zIndex:2*e,flat:!0,clickable:!0,labelText:n.replace(/ /g,"&nbsp;"),labelOffset:new google.maps.Size(6,-7)});return s.id=e,s}function createArrow(e,a){var n=degrees_to_compass(e,a),i=new google.maps.Size(13,13),t=new google.maps.Point(6.5,33),o=arrowImgs[n];return new google.maps.MarkerImage(o,null,null,t,i)}function getBreadcrumbs(e){url="/readings/last/"+e,$.ajax({url:url}).done(function(e){for(var a=GXml.parse(e.responseText),n=a.documentElement.getElementsByTagName("id"),i=a.documentElement.getElementsByTagName("lat"),t=a.documentElement.getElementsByTagName("lng"),o=(a.documentElement.getElementsByTagName("alt"),a.documentElement.getElementsByTagName("spd")),s=(a.documentElement.getElementsByTagName("dir"),a.documentElement.getElementsByTagName("geofence")),d=a.documentElement.getElementsByTagName("dt"),r=a.documentElement.getElementsByTagName("address"),l=a.documentElement.getElementsByTagName("event_type"),c=a.documentElement.getElementsByTagName("note"),g=i.length-1;g>=0;g--)if(i[g].firstChild){var f="N/A";r[g].firstChild!=undefined&&(f=r[g].firstChild.nodeValue);var p="";c[g].firstChild!=undefined&&(p=c[g].firstChild.nodeValue);var m=null==s[g].firstChild?null:s[g].firstChild.nodeValue,u=(o[g].firstChild.nodeValue,l[g].firstChild.nodeValue),w={id:n[g].firstChild.nodeValue,lat:i[g].firstChild.nodeValue,lng:t[g].firstChild.nodeValue,address:f,dt:d[g].firstChild.nodeValue,note:p,event:u,geofence:m};readings.push(w);var v=new google.maps.LatLng(w.lat,w.lng),_=getMarkerType(w);0==g?(createMarker(w.id,v,recenticon,createReadingHtml(w.id)),gmap.setCenter(v),openInfoWindowHtml(v,createReadingHtml(w.id)),highlightRow(w.id)):createMarker(w.id,v,_,createReadingHtml(w.id))}})}function getReadingById(e){for(var a=0;a<readings.length;a++){var n=readings[a];if(n.id==e)return n}}function getDeviceByLastGPSReadingId(e){for(var a=0;a<devices.length;a++){var n=devices[a];if(n.last_gps_reading_id==e)return n}}function updateReadingForTrip(e,a,n){reading=getReadingById(e),"undefined"!=typeof reading&&(reading.start=a,reading.stop=n)}function initializeGoogleMap(){window.default_map_type==undefined&&(window.default_map_type=google.maps.MapTypeId.ROADMAP);var e=$("#map").data("default-map-center");window.centerLatLng=new google.maps.LatLng(e.lat,e.lng),gmap=new google.maps.Map($("#map")[0],{zoom:8,center:window.centerLatLng,streetViewControl:!0,mapTypeId:window.default_map_type,gestureHandling:"greedy",scrollwheel:!0,mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.ROADMAP]},scaleControl:!0,scaleControlOptions:{position:google.maps.ScaleControlStyle.RIGHT},styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]}]}),ie<9&&gmap.setTilt(0),google.maps.event.addDomListener(gmap,"closeclick",function(){dev_id=!1,highlightRow(0),window.activeDeviceId=null}),google.maps.event.addDomListener(gmap,"dragend",function(){new_drag_point=gmap.getCenter()}),installMoveListener(),google.maps.event.addDomListener(gmap,"infowindowopen",pauseMoveListener),google.maps.event.addDomListener(gmap,"maptypeid_changed",setMapTypePreference)}function installMoveListener(){window.moveListener=google.maps.event.addDomListener(gmap,"bounds_changed",function(){zoom=gmap.getZoom(),window.mapOverlayVisibilityTimeout&&window.clearTimeout(window.mapOverlayVisibilityTimeout),window.mapOverlayVisibilityTimeout=window.setTimeout("showVisibleMapOverlays();",500)})}function pauseMoveListener(){google.maps.event.removeListener(window.moveListener),window.setTimeout("installMoveListener()",1e3)}function showVisibleMapOverlays(){var e=gmap.getBounds();if(gmap.getZoom()<6||!e)return!1;var a=e.getNorthEast(),n=e.getSouthWest(),i=n.lng(),t=a.lng(),o=a.lat(),s=n.lat();window.remote_url="/utils/ACTION",window.remote_url+="?x1="+i+"&y1="+o+"&x2="+t+"&y2="+s,window.device_id!=undefined&&(window.remote_url+="&d="+window.device_id),null==window.frameSpecificOverlays&&initializeFrameSpecificOverlays(),null==window.frameSpecificOverlayVisibilities&&(window.frameSpecificOverlayVisibilities=["geofences","placemarks"]),(frameSpecificOverlayVisibilitiesIncludes("geofences")||frameSpecificOverlayVisibilitiesIncludes("placemarks"))&&fetchNewGeofencesAndPlacemarks()}function toggleGeofenceVisibility(e){!e.checked&&frameSpecificOverlayVisibilitiesIncludes("geofences")&&(window.frameSpecificOverlayVisibilities=window.frameSpecificOverlayVisibilities.filter(function(e){return"geofences"!=e}),hideFrameSpecificOverlays("geofences"),setViewPreference("geofences",!1)),e.checked&&!frameSpecificOverlayVisibilitiesIncludes("geofences")&&(window.frameSpecificOverlayVisibilities.push("geofences"),frameSpecificOverlayVisibilitiesIncludes("placemarks")?drawFrameSpecificOverlays("geofences"):fetchNewGeofencesAndPlacemarks(),setViewPreference("geofences",!0))}function fetchNewGeofencesAndPlacemarks(){window.remote_url&&$.ajax({url:window.remote_url.replace("ACTION","overlays_in_bounds")}).done(function(transport){var data=transport,evaled=eval("("+data+")");hideFrameSpecificOverlays("all"),window.frameSpecificOverlays.geofences=[],window.frameSpecificOverlays.placemarks=[],window.frameSpecificOverlays.messages=[],createFrameSpecificOverlays(evaled),drawFrameSpecificOverlays("all")})}function hideFrameSpecificOverlays(e){if("all"==e)hideFrameSpecificOverlays("geofences"),hideFrameSpecificOverlays("placemarks");else if(window.frameSpecificOverlays[e]!=undefined)for(var a=0;a<window.frameSpecificOverlays[e].length;a++)window.frameSpecificOverlays[e][a].setMap(null)}function initializeFrameSpecificOverlays(){window.frameSpecificOverlays={geofences:[],placemarks:[],messages:[]},window.frameSpecificOverlayLookupHash={}}function createFrameSpecificOverlays(e){var a;if(e.geofences!=undefined)for(a=0;a<e.geofences.length;a++)window.frameSpecificOverlays.geofences.push(e.geofences[a]["polygonal?"]?createPolygonalGeofence(e.geofences[a]):createCircularGeofence(e.geofences[a]));if(e.placemarks!=undefined)for(a=0;a<e.placemarks.length;a++)window.frameSpecificOverlays.placemarks.push(createPlacemark(e.placemarks[a]));if(e.messages!=undefined){(e.messages[0]!=undefined&&e.messages[0].match(/placemarks/)&&frameSpecificOverlayVisibilitiesIncludes("placemarks")||d_had_a_message)&&createFadingMessage(e.messages[0])}}function drawFrameSpecificOverlays(e){if("all"==e)drawFrameSpecificOverlays("geofences"),drawFrameSpecificOverlays("placemarks"),window.frameSpecificOverlayLookupHash&&window.autoOpenOverlayKey&&window.frameSpecificOverlayLookupHash[window.autoOpenOverlayKey]&&(google.maps.event.trigger(window.frameSpecificOverlayLookupHash[window.autoOpenOverlayKey],"click"),window.autoOpenOverlayKey=null);else if(window.frameSpecificOverlays[e]!=undefined&&frameSpecificOverlayVisibilitiesIncludes(e))for(var a=0;a<window.frameSpecificOverlays[e].length;a++)window.frameSpecificOverlays[e][a].setMap(gmap),window.frameSpecificOverlays[e][a].setOptions({zIndex:a})}function createFadingMessage(e){var a=$("#gmap_message");if(null==a)return!1;a.innerHTML="",e==undefined&&(e=""),""!=e&&null!=a&&(a.style.visibility="visible",a.innerHTML=e),window.timeout!=undefined&&window.clearTimeout(window.timeout),window.timeout=window.setTimeout("$('#gmap_message').hide();",5e3)}function createPlacemark(e){var a=undefined;if(a=e.account_id!=undefined?'<%= image_path("icons/orange_circle.png") %>':'<%= image_path("icons/red_circle.png") %>'){var n=new google.maps.Marker({position:new google.maps.LatLng(e.latitude,e.longitude),title:e.name,icon:a}),i="<div class='notTooWide'><b>Placemark:</b> "+e.name+"<br /><br /><a href='#' onclick='maxZoomTo("+e.latitude+", "+e.longitude+")'>Zoom In</a></div>";return google.maps.event.addDomListener(n,"click",function(){window.activeDeviceId=null,openInfoWindowHtml(new google.maps.LatLng(e.latitude,e.longitude),i)}),window.frameSpecificOverlayLookupHash["p"+e.id]=n,n}return undefined}function maxZoomTo(e,a){gmap.setCenter(new google.maps.LatLng(e,a)),gmap.setZoom(15)}function geofenceInfoWindowHtml(e){return'<div class="tt_container"><div class="tt_container__sidebar"><div class="tt_container__sidebar__text_container">Location</div></div><div class="tt_container__body"><p class="tt_container__body__name">'+e.name+'</p><div class="tt_container__body__link tt_container__body__link--large">'+e.address+'</div><br /><br /><a class="tt_container__body__link" href="#" onclick="zoomToBoundsByCorner('+e.square_bounds.join(", ")+')">Zoom In</a></div><div class="clearfix"></div>'}function zoomToBoundsByCorner(e,a,n,i){gmap.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(e,a),new google.maps.LatLng(n,i)))}function createPolygonalGeofence(e){var a=3,n=.75,i=.1,t=e.polypoints.map(function(e){return new google.maps.LatLng(e.latitude,e.longitude)});(t[0]!=undefined&&t[0].lat()!=t[t.length-1].lat()||t[0].lng()!=t[t.length-1].lng())&&t.push(t[0]);var o=new google.maps.Polygon({path:t,strokeColor:e.color,strokeWeight:a,strokeOpactiy:n,fillColor:e.color,fillOpacity:i}),s=geofenceInfoWindowHtml(e);return google.maps.event.addDomListener(o,"click",function(){window.activeDeviceId=null,openInfoWindowHtml(new google.maps.LatLng(e.latitude,e.longitude),s,null,-110)}),window.frameSpecificOverlayLookupHash["g"+e.id]=o,o}function createCircularGeofence(e){var a=3,n=.75,i=.1,t=new google.maps.Circle({center:new google.maps.LatLng(e.latitude,e.longitude),radius:1609.344*e.radius,strokeColor:e.color,strokeWeight:a,strokeOpactiy:n,fillColor:e.color,fillOpacity:i}),o=geofenceInfoWindowHtml(e);return google.maps.event.addDomListener(t,"click",function(){window.activeDeviceId=null,openInfoWindowHtml(new google.maps.LatLng(e.latitude,e.longitude),o,null,-110)}),window.frameSpecificOverlayLookupHash["g"+e.id]=t,t}function setViewPreference(e,a){var n="/utils/set_view_preference?type="+e+"&checked="+(a?"y":"n");return $.get(n),!0}function setMapTypePreference(){var e="/utils/set_view_preference?map="+gmap.getMapTypeId();return $.get(e),!0}function frameSpecificOverlayVisibilitiesIncludes(e){return auxiliar=window.frameSpecificOverlayVisibilities.filter(function(a){return a==e}),1==auxiliar.length}function LabeledMarker(e,a,n){this.latlng=a,this.labelText=n.labelText||"",this.labelClass=n.labelClass||"marker-label",this.labelOffset=n.labelOffset||new google.maps.Size(0,0),this.googleMarker=n.googleMarker||new google.maps.Marker(new google.maps.LatLng(0,0)),this.icon=n.icon,this.point=n.point,this.id=n.id,this.zIndex=n.zIndex,this.shadowImage=n.shadowImage||"/assets/ublip_marker_shadow-bf2943edc3bccd26631c3b01d44576f246afe6a7e2b79f0fa69084f06c987176.png",this.html=n.html,this.div_=null,this.setMap(e)}var gmap,prevSelectedRow,prevSelectedRowClass,currSelectedDeviceId,dev_id,device_id,devices=[],readings=[],grp_id,fullScreenMap=!1,infowindow,new_drag_point,zoom=15,rgeo_counter=0,arrowImgs={e:"/assets/icons/arrows/e-5c033ed3f63c81a8d063b6d01403ef3b9eb630b9da36bbd9b218a15f76ba9bac.png",n:"/assets/icons/arrows/n-599f84be1b85eaa603192932f58c92c987dd2dee95f43c2794535810465fe0a3.png",ne:"/assets/icons/arrows/ne-ca07eb4afd779f61ffe4de34479f8e91fd4008ed2cef03d552dd46c95b313d13.png",none:"/assets/icons/arrows/none-8f3b7670aed999b32ff52d1e351bcc00f8faecf4b3c417f9092fe44cd650feab.png",nw:"/assets/icons/arrows/nw-cbf5244b691e6b0249404ee046b7eacc8497625ca1a4b646eb73ed1f0f424a04.png",s:"/assets/icons/arrows/s-b87d84fd676de8560c819bdc4247c052cc6ea98b09a3ce5485e2801a23bfa0f0.png",se:"/assets/icons/arrows/se-e68ed3007f18c2f849208042edd5128973d6d4622e38e388f3ca4561ba66c63d.png",sw:"/assets/icons/arrows/sw-87e6c4918e8425166a489fe1fc299a84b307d6c9b950eae36117f6e8a075a93e.png",w:"/assets/icons/arrows/w-3d55d3d2c2dc2ba9da93c403b6a321321b4dd8fff8b978def53eee0c820bfb53.png"};initializeFrameSpecificOverlays();var ie=function(){for(var e,a=3,n=document.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",i[0];);return a>4?a:e}();LabeledMarker.prototype=new google.maps.OverlayView,LabeledMarker.prototype.onAdd=function(){var e=document.createElement("DIV");e.className=this.labelClass,e.innerHTML=this.labelText,e.style.position="absolute",this.googleMarker=new google.maps.Marker({position:this.point,icon:this.icon,zIndex:this.zIndex,clickable:!0,shadow:new google.maps.MarkerImage(this.shadowImage,null,null,new google.maps.Point(11,34))}),this.googleMarker.id=this.id,this.googleMarker.setMap(this.getMap()),function(e){google.maps.event.addDomListener(e,"click",function(){focusOnAndFollow(e.id)})}(this.googleMarker),null==window.deviceLookupHash&&(window.deviceLookupHash={}),window.deviceLookupHash[this.googleMarker.id]=this.googleMarker,this.div_=e,this.getPanes().floatShadow.appendChild(this.div_)},LabeledMarker.prototype.draw=function(){var e=this.getProjection(),a=e.fromLatLngToDivPixel(this.latlng),n=this.googleMarker.getZIndex(this.latlng.lat());this.div_.style.left=a.x+6+"px",this.div_.style.top=a.y-15+"px",this.div_.style.zIndex=n+1},LabeledMarker.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.googleMarker.setMap(null))},LabeledMarker.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden",this.googleMarker.setMap(null))},LabeledMarker.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible",this.googleMarker.setMap(this.map_))},LabeledMarker.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?(this.googleMarker.setMap(this.map_),this.show()):(this.googleMarker.setMap(null),this.hide()))},LabeledMarker.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)};